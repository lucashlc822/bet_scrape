<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Xm-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetScrape</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <nav>
                <h1 class="logo">Bet Scrape</h1>
                <img src="" alt="">
                <ul>
                    <li><a href="#header">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </nav>
        </div>
        <div class="header-text">
            <p>Looking to increase your betting odds?</p>
            <h1><span>Search</span> for Player <br> Info below!</h1>
        </div>

    </header>

<!-- -------player search area------------ -->
    <form action="/scrape" method="POST" id="Search">
        <label for="url">Player Search:</label>
        <div class="input-container">
            <input type="text" id="url" name="url" required oninput="getOptions(this.value)">
            <button type="submit">Search</button>    
        </div>
        <!--Code for Dropdown menu upon selecting the input section of the form-->
        <select name="options" id="options" size="10" onchange="fillInput(this.value)"> <!-- size limits number of entries shown when the dropdown opens-->
        </select>

        <script>
            function getOptions(searchValue) {
                fetch(`/get_options?url=${encodeURIComponent(searchValue)}`) //encodeURIcomponent used to make sure all special characters are properly encoded
                .then(response => response.json()) //response from flask app.
                .then(data => {
                    const select = document.getElementById('options');
                    select.innerHTML = '';
                    data.forEach(option => {
                        const optionElement = document.createElement('option'); //creates option element for the select element in the form
                        optionElement.value = option;
                        optionElement.text = option;
                        select.add(optionElement);
                    });
                });
            }

            function fillInput(selectedValue) { //function that updates the input field 
                const input = document.getElementById('url')
                input.value = selectedValue; 
            }
// managing the player dropdown visibility
            var inputField = document.getElementById('url');
            var dropdownMenu = document.getElementById('options');
            var form = document.getElementById('Search');

            inputField.addEventListener('focus', showDropdown);
            // add event listener for a click anywhere on the wepage
            document.body.addEventListener('click', checkFocus);
            
            function showDropdown() {
                dropdownMenu.style.display = 'block';
            }
            // check if the focus is within the form, hide the dropdown if the focus is outside the form
            function checkFocus(event) {
                if (!form.contains(event.target)) {
                    dropdownMenu.style.display = 'none';
                }
            }
            
        </script>
    </form>

    <!-- --------team search area-------- -->
    <form action="/team_scrape" method="POST" id="Team_Search">
        <label for="team_url">Team Search:</label>
        <div class="input-container">
            <input type="input" id="team_url" name="team_url" required oninput="getTeamOptions(this.value)">
            <button type="submit">Search</button> 
        </div>
        <!-- Teams Dropdown Box  -->
        <select name="team_options" id="team_options" size="10" onchange="fillTeamInput(this.value)"></select>  

        <script>
            function getTeamOptions(searchValue) {
                fetch(`/get_team_options?team_url=${encodeURIComponent(searchValue)}`)
                .then(response => response.json())
                .then(data => {
                    const select = document.getElementById('team_options');
                    select.innerHTML = '';
                    data.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.text = option;
                        select.add(optionElement);
                    });
                });
            }

            function fillTeamInput(selectedValue) {
                const input = document.getElementById("team_url")
                input.value = selectedValue;
            }
// managing the team dropdown visibility
            var TeamInputField = document.getElementById('team_url');
            var TeamDropdownMenu = document.getElementById('team_options');
            var team_form = document.getElementById('Team_Search');

            TeamInputField.addEventListener('focus', showTeamDropdown);
            // add event listener for a click anywhere on the wepage
            document.body.addEventListener('click', TeamCheckFocus);
            
            function showTeamDropdown() {
                TeamDropdownMenu.style.display = 'block';
            }
            // check if the focus is within the form, hide the dropdown if the focus is outside the form
            function TeamCheckFocus(event) {
                if (!team_form.contains(event.target)) {
                    TeamDropdownMenu.style.display = 'none';
                }
            }
        </script>
    </form>
    
</body>
</html>
